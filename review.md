# Laravel Lesson レビュー①

## Todo一覧機能

### Todoモデルのallメソッドで実行しているSQLは何か

`select * from 'todos';`
これはLaravelで直接定義されたsql文ではなく、Todoモデルのプロパティを用いて生成される

### Todoモデルのallメソッドの返り値は何か

`Illuminate\Database\Eloquent\Collection`クラスのインスタンス

### 配列の代わりにCollectionクラスを使用するメリットは

`Collection`クラスはLaravelで用意されている配列操作に特化したクラスで、以下のようなメリットがある

- データ処理用のメソッドやModel専用メソッドが揃っている
- メソッドチェーンで読みやすい処理になる
- 元データを直接書き換えにくいためバグが起こりにくい

### view関数の第1・第2引数の指定と何をしているか

第1引数: 画面に表示したいbladeファイル
第2引数: 渡したいデータを連想配列の形(`blade内での変数名 => 代入したい値`)で渡す

### index.blade.phpの$todos・$todoに代入されているものは何か

`$todos`にはview関数によって渡された`Illuminate\Database\Eloquent\Collection`クラスのインスタンスを格納している
`todos`テーブルの全レコードを含んでいる

`$todo`は`Todo`モデルのインスタンスを格納している
`$todos`の1件分の要素を取り出したもの

## Todo作成機能

### Requestクラスのallメソッドは何をしているか

フォームから送信された値を個別ではなく一括で取得している
またallメソッドはCSRFトークンも含めてしまうため、以下を用いることで必要なデータだけを取り出すこともできる

- `$request->validate()`
- `$request->only(['title','content'])`
- `$request->except(['_token'])`

### fillメソッドは何をしているか

allメソッドを用いて連想配列で取得した値をTodoインスタンの各プロパティに一括で代入している
`$todo->{連想配列のkey} = {連想配列のvalue}`を配列全ての要素に対して行う

### $fillableは何のために設定しているか

悪意ある攻撃者によって意図しないカラムの値が上書きされるのを防ぐため

### saveメソッドで実行しているSQLは何か

`INSERT INTO todos(content, created_at, updated_at) VALUES (...)`
入力した`content`の値のほか、`created_at`と`updated_at`は自動的に付与される
また、`$todo->id`がすでに存在していた場合は`UPDATE`が実行される

### redirect()->route()は何をしているか

指定したルート名へリダイレクトする処理
`route('')`でルート名からURLを生成して302リダイレクトを返す

## その他

### テーブル構成をマイグレーションファイルで管理するメリット

- sql構文を扱えなくてもPHPコードでテーブル操作ができる
  →学習コストが少ない
- マイグレーションファイルをGitで共有することで開発者全員が同じテーブルを作成することができる
  →チームでアプリ開発をする際に役立つ

### マイグレーションファイルのup()、down()は何のコマンドを実行した時に呼び出されるのか

upコマンドを実行するときの構文
`php artisan migrate`
downコマンドを実行するときの構文
`php artisan migrate:rollback`

### Seederクラスの役割は何か

テスト用データや初期設定データを導入するためのクラス

### route関数の引数・返り値・使用するメリット

`route()`はルート名からURLを生成する関数

第一引数: ルート名(必須)
`->name('todos.show')`と宣言したものを指定する
第二引数: ルートパラメータ(任意)
例えばURLに`{id}`を使っている場合はここで渡す
返り値: URLの文字列を返す

また使用することで以下のようなメリットがある

- URLは変わってもroute名が変わらなければ修正不要
- 名前で意味が分かるため可読性が上がる

### @extends・@section・@yieldの関係性とbladeを分割するメリット

`@extends('Bladeファイルのパス')`を用いると他のBladeファイルを継承できる
`@section('任意の文字列') ~ @endsection`で囲った部分が継承したBladeファイルの`@yield('任意の文字列')`の箇所に挿入される(引数の文字列で紐づけている)

bladeを分割することで重複するコードを共通化して再利用できるため、保守性が向上する

### @csrfは何のための記述か

CSRF対策
挿入することでトークンを含む`input`タグが生成される

### {{ }}とは何の省略系か

`{{ $variable }}`は
`<?php echo e($variable); ?>`の省略形

`e()`はHTMLエスケープ関数
`{{ }}`は安全にHTMLエスケープして出力するためのショートカット
実際にスクリプトが入っていた場合もただのテキストとして扱われるため実行されない(XSS対策)

一方で`{!! !!}`は
`<?php echo $variable; ?>`の省略形でエスケープ処理されない